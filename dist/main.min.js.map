{"version":3,"file":"main.min.js","sources":["../src/intersection-observer-wrapper.js","../src/vertical-visibility-observer.js","../src/main.js"],"sourcesContent":["function IntersectionObserverWrapper(window) {\n\tthis._intersectionObserver = new window.IntersectionObserver(this._handleIntersectionChanged.bind(this));\n\tthis._observing = new Map();\n}\n\nIntersectionObserverWrapper.prototype.observe = function (element, onVisibilityChanged) {\n\tthis._intersectionObserver.observe(element);\n\tthis._observing.set(element, onVisibilityChanged);\n};\n\nIntersectionObserverWrapper.prototype.unobserve = function (element) {\n\tthis._intersectionObserver.unobserve(element);\n\tthis._observing.delete(element);\n};\n\nIntersectionObserverWrapper.prototype._handleIntersectionChanged = function (entries) {\n\tconst observing = this._observing;\n\n\tentries.forEach(function (entry) {\n\t\tconst isVisible = entry.intersectionRatio > 0;\n\t\tconst element = entry.target;\n\t\tconst onVisibilityChanged = observing.get(element);\n\n\t\tonVisibilityChanged(isVisible, element);\n\t});\n};\n\nmodule.exports = IntersectionObserverWrapper;\n","function VerticalVisibilityObserver(window) {\n\tthis._window = window;\n\tthis._viewport = { top: 0, bottom: 0 };\n\tthis._observing = new Map();\n\tthis._handleResize = this._handleResize.bind(this);\n\tthis._handleScroll = this._handleScroll.bind(this);\n}\n\nVerticalVisibilityObserver.prototype.observe = function (element, onVisibilityChanged) {\n\tconst info = { top: 0, bottom: 0, isVisible: null, onVisibilityChanged };\n\n\tif (this._observing.size === 0) {\n\t\tthis._updateViewport();\n\t\tthis._addListeners();\n\t}\n\n\tthis._observing.set(element, info);\n\tthis._updateElement(info, element);\n};\n\nVerticalVisibilityObserver.prototype.unobserve = function (element) {\n\tthis._observing.delete(element);\n\n\tif (this._observing.size === 0) {\n\t\tthis._removeListeners();\n\t}\n};\n\nVerticalVisibilityObserver.prototype._addListeners = function () {\n\t// TODO: Add load and/or orientationchange events?\n\tthis._window.addEventListener('resize', this._handleResize);\n\tthis._window.addEventListener('scroll', this._handleScroll);\n};\n\nVerticalVisibilityObserver.prototype._removeListeners = function () {\n\tthis._window.removeEventListener('resize', this._handleResize);\n\tthis._window.removeEventListener('scroll', this._handleScroll);\n};\n\nVerticalVisibilityObserver.prototype._updateViewport = function () {\n\tconst top = this._viewport.top = this._window.scrollY;\n\tconst height = this._window.innerHeight;\n\n\tthis._viewport.bottom = top + height;\n};\n\nVerticalVisibilityObserver.prototype._updateElement = function (info, element) {\n\tinfo.top = element.offsetTop;\n\tinfo.bottom = info.top + element.offsetHeight;\n\n\tthis._updateElementVisibilty(info, element);\n};\n\nVerticalVisibilityObserver.prototype._updateElementVisibilty = function (info, element) {\n\tconst viewport = this._viewport;\n\tconst isVisible = info.top < viewport.bottom && info.bottom > viewport.top;\n\n\tif (isVisible !== info.isVisible) {\n\t\tinfo.isVisible = isVisible;\n\t\tinfo.onVisibilityChanged(isVisible, element);\n\t}\n};\n\nVerticalVisibilityObserver.prototype._handleResize = function () {\n\tthis._updateViewport();\n\tthis._observing.forEach(this._updateElement, this);\n};\n\nVerticalVisibilityObserver.prototype._handleScroll = function () {\n\tthis._updateViewport();\n\tthis._observing.forEach(this._updateElementVisibilty, this);\n};\n\nmodule.exports = VerticalVisibilityObserver;\n","const IntersectionObserverWrapper = require('./intersection-observer-wrapper');\nconst VerticalVisibilityObserver = require('./vertical-visibility-observer');\n\nmodule.exports = function (window) {\n\tif ('IntersectionObserver' in window && 'IntersectionObserverEntry' in window) {\n\t\treturn new IntersectionObserverWrapper(window);\n\t}\n\n\treturn new VerticalVisibilityObserver(window);\n};\n"],"names":["IntersectionObserverWrapper","window","_intersectionObserver","IntersectionObserver","_handleIntersectionChanged","bind","_observing","Map","prototype","observe","element","onVisibilityChanged","set","unobserve","delete","entries","observing","forEach","entry","isVisible","intersectionRatio","target","get","VerticalVisibilityObserver","_window","_viewport","top","bottom","_handleResize","_handleScroll","info","size","_updateViewport","_addListeners","_updateElement","_removeListeners","addEventListener","removeEventListener","scrollY","height","innerHeight","offsetTop","offsetHeight","_updateElementVisibilty","viewport"],"mappings":"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"}