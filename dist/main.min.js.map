{"version":3,"file":"main.min.js","sources":["../src/intersection-observer-wrapper.js","../src/vertical-visibility-observer.js","../src/main.js"],"sourcesContent":["function IntersectionObserverWrapper(window) {\n\tthis._intersectionObserver = new window.IntersectionObserver(this._handleIntersectionChanged.bind(this));\n\tthis._observing = new Map();\n}\n\nconst IntersectionObserverWrapperPrototype = IntersectionObserverWrapper.prototype;\n\nIntersectionObserverWrapperPrototype.observe = function (element, onVisibilityChanged) {\n\tthis._intersectionObserver.observe(element);\n\tthis._observing.set(element, onVisibilityChanged);\n};\n\nIntersectionObserverWrapperPrototype.unobserve = function (element) {\n\tthis._intersectionObserver.unobserve(element);\n\tthis._observing.delete(element);\n};\n\nIntersectionObserverWrapperPrototype._handleIntersectionChanged = function (entries) {\n\tconst observing = this._observing;\n\n\tentries.forEach(function (entry) {\n\t\tconst isVisible = entry.intersectionRatio > 0;\n\t\tconst element = entry.target;\n\t\tconst onVisibilityChanged = observing.get(element);\n\n\t\tonVisibilityChanged(isVisible, element);\n\t});\n};\n\nmodule.exports = IntersectionObserverWrapper;\n","function VerticalVisibilityObserver(window) {\n\tthis._window = window;\n\tthis._viewport = { top: 0, bottom: 0 };\n\tthis._observing = new Map();\n\tthis._handleResize = this._handleResize.bind(this);\n\tthis._handleScroll = this._handleScroll.bind(this);\n}\n\nconst VerticalVisibilityObserverPrototype = VerticalVisibilityObserver.prototype;\n\nVerticalVisibilityObserverPrototype.observe = function (element, onVisibilityChanged) {\n\tconst info = { top: 0, bottom: 0, isVisible: null, onVisibilityChanged };\n\n\tif (this._observing.size === 0) {\n\t\tthis._updateViewportDimensions();\n\t\tthis._addListeners();\n\t}\n\n\tthis._observing.set(element, info);\n\tthis._updateElementDimensions(info, element);\n\tthis._updateElementVisibilty(info, element);\n};\n\nVerticalVisibilityObserverPrototype.unobserve = function (element) {\n\tthis._observing.delete(element);\n\n\tif (this._observing.size === 0) {\n\t\tthis._removeListeners();\n\t}\n};\n\nVerticalVisibilityObserverPrototype._addListeners = function () {\n\tthis._window.addEventListener('load', this._handleResize);\n\tthis._window.addEventListener('resize', this._handleResize);\n\tthis._window.addEventListener('scroll', this._handleScroll);\n};\n\nVerticalVisibilityObserverPrototype._removeListeners = function () {\n\tthis._window.removeEventListener('load', this._handleResize);\n\tthis._window.removeEventListener('resize', this._handleResize);\n\tthis._window.removeEventListener('scroll', this._handleScroll);\n};\n\nVerticalVisibilityObserverPrototype._updateViewportDimensions = function () {\n\tconst top = this._viewport.top = this._window.scrollY;\n\tconst height = this._window.innerHeight;\n\n\tthis._viewport.bottom = top + height;\n};\n\nVerticalVisibilityObserverPrototype._updateElementDimensions = function (info, element) {\n\tinfo.top = element.offsetTop;\n\tinfo.bottom = info.top + element.offsetHeight;\n};\n\nVerticalVisibilityObserverPrototype._updateElementVisibilty = function (info, element) {\n\tconst viewport = this._viewport;\n\tconst isVisible = info.top < viewport.bottom && info.bottom > viewport.top;\n\n\tif (isVisible !== info.isVisible) {\n\t\tinfo.isVisible = isVisible;\n\t\tinfo.onVisibilityChanged(isVisible, element);\n\t}\n};\n\nVerticalVisibilityObserverPrototype._handleResize = function () {\n\t// group style *reads* before *writes*\n\tthis._updateViewportDimensions();\n\tthis._observing.forEach(this._updateElementDimensions, this);\n\tthis._observing.forEach(this._updateElementVisibilty, this);\n};\n\nVerticalVisibilityObserverPrototype._handleScroll = function () {\n\tthis._updateViewportDimensions();\n\tthis._observing.forEach(this._updateElementVisibilty, this);\n};\n\nmodule.exports = VerticalVisibilityObserver;\n","const IntersectionObserverWrapper = require('./intersection-observer-wrapper');\nconst VerticalVisibilityObserver = require('./vertical-visibility-observer');\n\nmodule.exports = function (window) {\n\tif ('IntersectionObserver' in window && 'IntersectionObserverEntry' in window) {\n\t\treturn new IntersectionObserverWrapper(window);\n\t}\n\n\treturn new VerticalVisibilityObserver(window);\n};\n"],"names":["IntersectionObserverWrapper","window","_intersectionObserver","IntersectionObserver","this","_handleIntersectionChanged","bind","_observing","Map","VerticalVisibilityObserver","_window","_viewport","top","bottom","_handleResize","_handleScroll","IntersectionObserverWrapperPrototype","prototype","observe","element","onVisibilityChanged","set","unobserve","delete","entries","observing","forEach","entry","isVisible","intersectionRatio","target","get","VerticalVisibilityObserverPrototype","info","size","_updateViewportDimensions","_addListeners","_updateElementDimensions","_updateElementVisibilty","_removeListeners","addEventListener","removeEventListener","scrollY","height","innerHeight","offsetTop","offsetHeight","viewport"],"mappings":"8LAAA,SAASA,EAA4BC,QAC/BC,EAAwB,IAAID,EAAOE,qBAAqBC,KAAKC,EAA2BC,KAAKF,YAC7FG,EAAa,IAAIC,ICFvB,SAASC,EAA2BR,QAC9BS,EAAUT,OACVU,GAAcC,IAAK,EAAGC,OAAQ,QAC9BN,EAAa,IAAIC,SACjBM,EAAgBV,KAAKU,EAAcR,KAAKF,WACxCW,EAAgBX,KAAKW,EAAcT,KAAKF,MDA9C,IAAMY,EAAuChB,EAA4BiB,UAEzED,EAAqCE,QAAU,SAAUC,EAASC,QAC5DlB,EAAsBgB,QAAQC,QAC9BZ,EAAWc,IAAIF,EAASC,IAG9BJ,EAAqCM,UAAY,SAAUH,QACrDjB,EAAsBoB,UAAUH,QAChCZ,EAAWgB,OAAOJ,IAGxBH,EAAqCX,EAA6B,SAAUmB,OACrEC,EAAYrB,KAAKG,IAEfmB,QAAQ,SAAUC,OACnBC,EAAYD,EAAME,kBAAoB,EACtCV,EAAUQ,EAAMG,OACML,EAAUM,IAAIZ,GAEtBS,EAAWT,MAIjC,MAAiBnB,ECrBXgC,EAAsCvB,EAA2BQ,UAEvEe,EAAoCd,QAAU,SAAUC,EAASC,OAC1Da,GAASrB,IAAK,EAAGC,OAAQ,EAAGe,UAAW,KAAMR,uBAEtB,IAAzBhB,KAAKG,EAAW2B,YACdC,SACAC,UAGD7B,EAAWc,IAAIF,EAASc,QACxBI,EAAyBJ,EAAMd,QAC/BmB,EAAwBL,EAAMd,IAGpCa,EAAoCV,UAAY,SAAUH,QACpDZ,EAAWgB,OAAOJ,GAEM,IAAzBf,KAAKG,EAAW2B,WACdK,KAIPP,EAAoCI,EAAgB,gBAC9C1B,EAAQ8B,iBAAiB,OAAQpC,KAAKU,QACtCJ,EAAQ8B,iBAAiB,SAAUpC,KAAKU,QACxCJ,EAAQ8B,iBAAiB,SAAUpC,KAAKW,IAG9CiB,EAAoCO,EAAmB,gBACjD7B,EAAQ+B,oBAAoB,OAAQrC,KAAKU,QACzCJ,EAAQ+B,oBAAoB,SAAUrC,KAAKU,QAC3CJ,EAAQ+B,oBAAoB,SAAUrC,KAAKW,IAGjDiB,EAAoCG,EAA4B,eACzDvB,EAAMR,KAAKO,EAAUC,IAAMR,KAAKM,EAAQgC,QACxCC,EAASvC,KAAKM,EAAQkC,iBAEvBjC,EAAUE,OAASD,EAAM+B,GAG/BX,EAAoCK,EAA2B,SAAUJ,EAAMd,KACzEP,IAAMO,EAAQ0B,YACdhC,OAASoB,EAAKrB,IAAMO,EAAQ2B,cAGlCd,EAAoCM,EAA0B,SAAUL,EAAMd,OACvE4B,EAAW3C,KAAKO,EAChBiB,EAAYK,EAAKrB,IAAMmC,EAASlC,QAAUoB,EAAKpB,OAASkC,EAASnC,IAEnEgB,IAAcK,EAAKL,cACjBA,UAAYA,IACZR,oBAAoBQ,EAAWT,KAItCa,EAAoClB,EAAgB,gBAE9CqB,SACA5B,EAAWmB,QAAQtB,KAAKiC,EAA0BjC,WAClDG,EAAWmB,QAAQtB,KAAKkC,EAAyBlC,OAGvD4B,EAAoCjB,EAAgB,gBAC9CoB,SACA5B,EAAWmB,QAAQtB,KAAKkC,EAAyBlC,OAGvD,MAAiBK,SC1EA,SAAUR,SACtB,yBAA0BA,GAAU,8BAA+BA,EAC/D,IAAID,EAA4BC,GAGjC,IAAIQ,EAA2BR"}