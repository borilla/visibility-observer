{"version":3,"file":"main.js","sources":["../src/intersection-observer-wrapper.js","../src/vertical-visibility-observer.js","../src/main.js"],"sourcesContent":["function IntersectionObserverWrapper(window) {\n\tthis._intersectionObserver = new window.IntersectionObserver(this._handleIntersectionChanged.bind(this));\n\tthis._observing = new Map();\n}\n\nconst IntersectionObserverWrapperPrototype = IntersectionObserverWrapper.prototype;\n\nIntersectionObserverWrapperPrototype.observe = function (element, onVisibilityChanged) {\n\tthis._intersectionObserver.observe(element);\n\tthis._observing.set(element, onVisibilityChanged);\n};\n\nIntersectionObserverWrapperPrototype.unobserve = function (element) {\n\tthis._intersectionObserver.unobserve(element);\n\tthis._observing.delete(element);\n};\n\nIntersectionObserverWrapperPrototype._handleIntersectionChanged = function (entries) {\n\tconst observing = this._observing;\n\n\tentries.forEach(function (entry) {\n\t\tconst isVisible = entry.intersectionRatio > 0;\n\t\tconst element = entry.target;\n\t\tconst onVisibilityChanged = observing.get(element);\n\n\t\tonVisibilityChanged(isVisible, element);\n\t});\n};\n\nmodule.exports = IntersectionObserverWrapper;\n","function VerticalVisibilityObserver(window) {\n\tthis._window = window;\n\tthis._viewport = { top: 0, bottom: 0 };\n\tthis._observing = new Map();\n\tthis._handleResize = this._handleResize.bind(this);\n\tthis._handleScroll = this._handleScroll.bind(this);\n}\n\nconst VerticalVisibilityObserverPrototype = VerticalVisibilityObserver.prototype;\n\nVerticalVisibilityObserverPrototype.observe = function (element, onVisibilityChanged) {\n\tconst info = { top: 0, bottom: 0, isVisible: null, onVisibilityChanged };\n\n\tif (this._observing.size === 0) {\n\t\tthis._updateViewportDimensions();\n\t\tthis._addListeners();\n\t}\n\n\tthis._observing.set(element, info);\n\tthis._updateElementDimensions(info, element);\n\tthis._updateElementVisibilty(info, element);\n};\n\nVerticalVisibilityObserverPrototype.unobserve = function (element) {\n\tthis._observing.delete(element);\n\n\tif (this._observing.size === 0) {\n\t\tthis._removeListeners();\n\t}\n};\n\nVerticalVisibilityObserverPrototype._addListeners = function () {\n\tthis._window.addEventListener('load', this._handleResize);\n\tthis._window.addEventListener('resize', this._handleResize);\n\tthis._window.addEventListener('scroll', this._handleScroll);\n};\n\nVerticalVisibilityObserverPrototype._removeListeners = function () {\n\tthis._window.removeEventListener('load', this._handleResize);\n\tthis._window.removeEventListener('resize', this._handleResize);\n\tthis._window.removeEventListener('scroll', this._handleScroll);\n};\n\nVerticalVisibilityObserverPrototype._updateViewportDimensions = function () {\n\tconst top = this._viewport.top = this._window.scrollY;\n\tconst height = this._window.innerHeight;\n\n\tthis._viewport.bottom = top + height;\n};\n\nVerticalVisibilityObserverPrototype._updateElementDimensions = function (info, element) {\n\tinfo.top = element.offsetTop;\n\tinfo.bottom = info.top + element.offsetHeight;\n};\n\nVerticalVisibilityObserverPrototype._updateElementVisibilty = function (info, element) {\n\tconst viewport = this._viewport;\n\tconst isVisible = info.top < viewport.bottom && info.bottom > viewport.top;\n\n\tif (isVisible !== info.isVisible) {\n\t\tinfo.isVisible = isVisible;\n\t\tinfo.onVisibilityChanged(isVisible, element);\n\t}\n};\n\nVerticalVisibilityObserverPrototype._handleResize = function () {\n\t// group style *reads* before *writes*\n\tthis._updateViewportDimensions();\n\tthis._observing.forEach(this._updateElementDimensions, this);\n\tthis._observing.forEach(this._updateElementVisibilty, this);\n};\n\nVerticalVisibilityObserverPrototype._handleScroll = function () {\n\tthis._updateViewportDimensions();\n\tthis._observing.forEach(this._updateElementVisibilty, this);\n};\n\nmodule.exports = VerticalVisibilityObserver;\n","const IntersectionObserverWrapper = require('./intersection-observer-wrapper');\nconst VerticalVisibilityObserver = require('./vertical-visibility-observer');\n\nmodule.exports = function (window) {\n\tif ('IntersectionObserver' in window && 'IntersectionObserverEntry' in window) {\n\t\treturn new IntersectionObserverWrapper(window);\n\t}\n\n\treturn new VerticalVisibilityObserver(window);\n};\n"],"names":["IntersectionObserverWrapper","window","_intersectionObserver","IntersectionObserver","_handleIntersectionChanged","bind","_observing","Map","IntersectionObserverWrapperPrototype","prototype","observe","element","onVisibilityChanged","set","unobserve","delete","entries","observing","forEach","entry","isVisible","intersectionRatio","target","get","VerticalVisibilityObserver","_window","_viewport","top","bottom","_handleResize","_handleScroll","VerticalVisibilityObserverPrototype","info","size","_updateViewportDimensions","_addListeners","_updateElementDimensions","_updateElementVisibilty","_removeListeners","addEventListener","removeEventListener","scrollY","height","innerHeight","offsetTop","offsetHeight","viewport"],"mappings":"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"}